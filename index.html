<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">

  <link rel="stylesheet" href="styles.css">

  <title>The Duality Programming Language</title>
</head>

<body>
  <textarea id="code-textarea" placeholder="Enter code here..." spellcheck="false"></textarea>

  <div id="result-div"></div>

  <script src="dy.js"></script>

  <script src="processCode.js"></script>

  <script>
    'use strict'

    let timeoutId

    function processCodeAndDisplay() {
      const code = document.getElementById('code-textarea').value
      if (!code) {
        document.getElementById('result-div').textContent = ''
        return
      }

      document.getElementById('result-div').textContent = processCode(code)

      timeoutId = undefined
    }

    const textArea = document.getElementById('code-textarea')

    const savedData = window.sessionStorage.getItem('code')
    if (savedData) {
      textArea.value = savedData
      timeoutId = window.setTimeout(processCodeAndDisplay, 1000 * 0.3)
    }

    textArea.addEventListener('input', function () {
      window.sessionStorage.setItem('code', textArea.value)

      if (timeoutId) {
        window.clearTimeout(timeoutId)
      }

      timeoutId = window.setTimeout(processCodeAndDisplay, 1000 * 0.3)
    })
  </script>
</body>

</html>