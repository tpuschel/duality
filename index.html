<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">

  <link rel="stylesheet" href="styles.css">

  <title>The Duality Programming Language</title>

  <link rel="icon" href="favicon.png">
</head>

<body>
  <header>
    <nav id="navBar">
      <a class="current-link" href="/index.html">Home</a>
      <a href="/documentation.html">Documentation</a>
      <a href="/downloads.html">Downloads</a>
      <a href="https://github.com/tpuschel/duality">Source on GitHub</a>
    </nav>
  </header>

  <main>
    <h4> Fully typed. Highly dynamic. A new kind of scripting language. </h4>

    <p style="margin: 3em auto;">
      Duality's designed to give you all the freedom of a dynamic language with all
      the safety of a static one. Combined with its lightweight syntax it lets
      you solve your problem exactly, correctly and without needless boilerplate.
    </p>

    <div id="welcome-content">
      <div id="code-box">
        <textarea id="code-textarea" placeholder="Enter code here..." spellcheck="false"></textarea>

        <div id="result-div"></div>
      </div>

      <div id="persuasion-list">
        <h4>
          A list of features in no particular order:
        </h4>

        <ul>
          <li> Expression-based </li>
          <li> Structurally typed </li>
          <li> Dependently typed </li>
          <li> Full type inference </li>
          <li> Highly dynamic </li>
          <li> Implemented as a set of C libraries </li>
          <li> Cross-platform </li>
          <li>
            <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a> support
          </li>
          <li>
            <a href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter Protocol</a> support
          </li>
          <li>
            <a href="https://marketplace.visualstudio.com/items?itemName=puschel.duality">Extension</a> for Visual
            Studio Code
          </li>
        </ul>
      </div>
    </div>

    <p style="margin: 3em auto;">
      Interested? Then check out the <a href="/documentation.html">documentation</a>
      for a deeper look at the language!
    </p>

    <script src="duality.js"></script>

    <script src="processCode.js"></script>

    <script>
      'use strict'

      let timeoutId = undefined

      let textArea = document.getElementById('code-textarea')

      let processCodeAndDisplay = () => {
        window.localStorage.setItem('code', textArea.value)

        timeoutId = undefined

        let resultDiv = document.getElementById('result-div')

        if (textArea.value) {
          resultDiv.textContent = processCode(textArea.value)
        } else {
          resultDiv.textContent = ''
        }
      }

      Module['onRuntimeInitialized'] = () => {
        let savedData = window.localStorage.getItem('code')
        if (savedData) {
          textArea.value = savedData
          processCodeAndDisplay()
        }

        textArea.addEventListener('input', () => {
          if (timeoutId) {
            window.clearTimeout(timeoutId)
          }

          timeoutId = window.setTimeout(processCodeAndDisplay, 1000 * 0.3)
        })
      }

      textArea.addEventListener('keydown', event => {
        if (event.isComposing || event.keyCode === 229) {
          return
        }

        if (event.key != "Tab") {
          return
        }

        event.preventDefault()

        if (textArea.selectionStart || textArea.selectionStart === 0) {
          let startPos = textArea.selectionStart
          let endPos = textArea.selectionEnd

          let tabReplacement = '    '

          textArea.value = textArea.value.substring(0, startPos) + tabReplacement + textArea.value.substring(endPos, textArea.value.length)
          textArea.selectionStart = startPos + tabReplacement.length
          textArea.selectionEnd = startPos + tabReplacement.length
        } else {
          textArea.value += tabReplacement
        }
      })
    </script>
  </main>
</body>

</html>